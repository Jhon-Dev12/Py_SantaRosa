<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{Admin/adminLayout}">

<!-- üé® Fragmento de estilos personalizados -->
<section layout:fragment="estilos">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</section>

<!-- üìã Contenido principal -->
<section layout:fragment="contenido">

  <div class="p-4">
    <h3 class="mb-3">Gesti√≥n de Horarios</h3>

    <!-- Informaci√≥n del m√©dico -->
    <form>
      <div class="row mb-3">
        <div class="col-md-3">
          <label>DNI</label>
          <input id="medicoDni" th:value="${medico?.dni}" class="form-control" readonly>
        </div>
        <div class="col-md-3">
          <label>Nombres</label>
          <input id="medicoNombres" th:value="${medico?.nombres}" class="form-control" readonly>
        </div>
        <div class="col-md-3">
          <label>Apellidos</label>
          <input id="medicoApellidos" th:value="${medico?.apellidos}" class="form-control" readonly>
        </div>
        <div class="col-md-3">
          <label>Especialidad</label>
          <input id="medicoEspecialidad" th:value="${medico?.especialidad?.nombreEspecialidad}" class="form-control" readonly>
        </div>
      </div>
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalMedico">
        Buscar M√©dico
      </button>
    </form>

    <hr>

    <!-- Modal de b√∫squeda de m√©dicos -->
    <div class="modal fade" id="modalMedico" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Buscar M√©dico</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="text" id="buscadorMedico" class="form-control mb-3" placeholder="Buscar m√©dico...">
            <button id="btnBuscarMedico" class="btn btn-primary mb-3">Buscar</button>

            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Apellidos</th>
                  <th>Especialidad</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="cuerpoMedicos"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <hr>

    <!-- Lista de horarios -->
    <h5>Horarios Registrados</h5>
    <table class="table table-bordered mt-2">
      <thead>
        <tr>
          <th>D√≠a</th>
          <th>Entrada</th>
          <th>Salida</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="hor : ${listaHorarios}">
          <td th:text="${hor.diaSemana}"></td>
          <td th:text="${hor.horarioEntrada}"></td>
          <td th:text="${hor.horarioSalida}"></td>
          <td>
            <a th:href="@{|/eliminar/${hor.idHorario}?idMedico=${medico.idMedico}|}" class="btn btn-danger btn-sm">Eliminar</a>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(listaHorarios)}">
          <td colspan="4" class="text-center">No hay horarios registrados</td>
        </tr>
      </tbody>
    </table>

    <!-- Formulario para registrar nuevo horario -->
    <form th:action="@{/registrar}" th:object="${nuevoHorario}" method="post" class="mt-4">
      <input type="hidden" id="medicoId" th:field="*{medico.idMedico}">
      <div class="row">
        <div class="col-md-3">
          <label>D√≠a</label>
          <select th:field="*{diaSemana}" class="form-select">
            <option value="" disabled selected>Seleccionar d√≠a</option>
            <option th:each="dia : ${T(com.example.entity.enums.DiaSemana).values()}"
                    th:value="${dia}" th:text="${dia}"></option>
          </select>
        </div>
        
        <div class="col-md-3">
          <label>Hora Entrada</label>
          <select th:field="*{horarioEntrada}" class="form-select">
            <option value="">Seleccionar hora</option>
            <option th:each="h : ${#numbers.sequence(0,23)}"
                    th:value="${h < 10 ? '0' + h + ':00' : h + ':00'}"
                    th:text="${h < 10 ? '0' + h + ':00' : h + ':00'}"></option>
          </select>
        </div>

        <div class="col-md-3">
          <label>Hora Salida</label>
          <select th:field="*{horarioSalida}" class="form-select">
            <option value="">Seleccionar hora</option>
            <option th:each="h : ${#numbers.sequence(0,23)}"
                    th:value="${h < 10 ? '0' + h + ':00' : h + ':00'}"
                    th:text="${h < 10 ? '0' + h + ':00' : h + ':00'}"></option>
          </select>
        </div>
        
        <div class="col-md-3 d-flex align-items-end">
          <button class="btn btn-primary w-100">Registrar</button>
        </div>
      </div>
    </form>

    <!-- Variables Thymeleaf + Script externo -->
    <script th:inline="javascript">
      let success = /*[[${success}]]*/ null;
      let error = /*[[${error}]]*/ null;
      let abrirModal = /*[[${abrirModal}]]*/ false;
    </script>

    <script th:src="@{/js/horario.js}"></script>
  </div>

</section>
</html>
